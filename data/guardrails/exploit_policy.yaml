# version: 1.0.4
policies:
  - id: EXP-SQL-INJECTION
    name: "Detect SQL Injection Patterns"
    description: |
      Flags user inputs containing common SQL injection payloads such as
      'UNION SELECT', 'OR 1=1', comment sequences, and other metacharacters.
    enabled: true
    severity: HIGH
    category: security
    matchers:
      - type: user_input
        field: content
        regex: (?ix)
          \b(union(\s+all)?\s+select|select\b.+\bfrom|or\s+1\s*=\s*1)\b
          |(--|#|/\*|\*/)\b
    action:
      type: block
      message: |
        I’m sorry, but your input appears to contain unsafe SQL patterns.

  - id: EXP-XSS
    name: "Detect Cross-Site Scripting (XSS) Patterns"
    description: |
      Flags user inputs containing script injection or event-handler patterns
      often used in XSS attacks.
    enabled: true
    severity: HIGH
    category: security
    matchers:
      - type: user_input
        field: content
        regex: (?ix)
          (<script\b|<img\b.+\bon\w+=|<svg\b.+\bon\w+=|javascript:|%3Cscript)
    action:
      type: block
      message: |
        I’m sorry, but your input appears to contain unsafe scripting patterns.

  - id: EXP-DIR-TRAVERSAL
    name: "Detect Directory Traversal Attempts"
    description: |
      Flags user inputs containing ../ or ..\ sequences used for
      directory traversal attacks.
    enabled: true
    severity: HIGH
    category: security
    matchers:
      - type: user_input
        field: content
        regex: (?ix)(\.\./|\.\.\\)
    action:
      type: block
      message: |
        I’m sorry, but directory traversal sequences are not allowed.

  - id: EXP-COMMAND-INJECTION
    name: "Detect Command Injection Patterns"
    description: |
      Flags user inputs containing shell metacharacters or commands that may
      be used for OS command injection.
    enabled: true
    severity: HIGH
    category: security
    matchers:
      - type: user_input
        field: content
        regex: (?ix)(;|\||&|\$\(|`|\b(curl|wget|nc|bash|sh)\b)
    action:
      type: block
      message: |
        I’m sorry, but your input appears to contain unsafe command patterns.

  - id: EXP-SSRF
    name: "Detect Server-Side Request Forgery (SSRF) Patterns"
    description: |
      Flags user inputs containing internal URLs or IP addresses often
      targeted by SSRF attacks.
    enabled: true
    severity: HIGH
    category: security
    matchers:
      - type: user_input
        field: content
        regex: (?ix)https?://(127\.0\.0\.1|localhost|\d{1,3}(?:\.\d{1,3}){3})([:/]|$)
    action:
      type: block
      message: |
        I’m sorry, but your input appears to contain unsafe internal URLs.

  - id: IN-PROMPT-INJECTION
    name: "Block Prompt-Injection Attempts"
    description: |
      Flags user inputs that try to override or “jailbreak” the system prompt
      (e.g. “ignore your previous instructions”, “let’s pretend…”).
    enabled: true
    severity: HIGH
    category: input_validation
    matchers:
      - type: user_input
        field: content
        regex: (?ix)\b(ignore (all )?previous instructions|jailbreak|system message)\b
    action:
      type: block
      message: |
        I’m sorry, but I can’t comply with that.

  - id: IN-MEDICAL-ADVICE
    name: "Block Medical Advice Requests"
    description: |
      Prevents dispensing medical diagnosis or treatment recommendations.
    enabled: true
    severity: HIGH
    category: input_validation
    matchers:
      - type: user_input
        field: content
        regex: (?ix)\b(symptom|diagnose|treatment|medication)\b
    action:
      type: block
      message: |
        I’m not a medical professional. For health advice, please consult a qualified practitioner.

  - id: IN-SECRET-EXFIL
    name: "Block Secret-Extraction Attempts"
    description: |
      Flags attempts to read environment variables or internal tokens.
    enabled: true
    severity: HIGH
    category: security
    matchers:
      - type: user_input
        field: content
        regex: (?ix)\$(?:\{)?(AWS_SECRET_ACCESS_KEY|API_KEY|TOKEN)(?:\})?
    action:
      type: block
      message: |
        I’m sorry, but I can’t help with that.

  - id: IN-PROMPT-TOO-LONG
    name: "Block Extremely Long Prompts"
    description: |
      Rejects inputs over X characters to guard against DOS or runaway loops.
    enabled: true
    severity: MEDIUM
    category: input_validation
    matchers:
      - type: user_input
        field: content
        regex: (?s)^.{5000,}$
    action:
      type: block
      message: |
        Your request is too long. Please shorten it.

  - id: IN-MKT-TIMING-ADVICE
    name: "Block Market Timing Advice"
    description: |
      Prevents advice on timing entry or exit points in financial markets.
    enabled: true
    severity: HIGH
    category: compliance
    matchers:
      - type: user_input
        field: content
        regex: (?ix)\b(buy|sell)\s+\w+\s+(at|when)\s+(\$\d+|\d+%?)\b
    action:
      type: block
      message: |
        I’m sorry, but I can’t provide market timing advice.
